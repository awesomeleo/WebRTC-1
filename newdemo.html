<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8" >
    <meta name='keywords' content='WebRTC, HTML5, JavaScript' />
    <meta name='description' content='WebRTC Reference App' />
    <meta name='viewport' content='width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1'>

    <base target='_blank'>

    <title>FX AdapComm VideoConference (New)</title>
    <link rel="stylesheet" href="style.css">


</head>
<body>
<script type='text/javascript' src="js/jquery-1.10.2.min.js"></script>

<h1 id='header'> FX AdapComm VideoConference:</h1>
<div class='loginClass' id='container'>

    <!--

    <div id='videos'>
        <video id='localVideo' width="320" height="180" autoplay="true"  muted="muted"></video>
        <video id='remoteVideo' width="320" height="180" autoplay="true" ></video>
    </div>

    -->


    <!--
    <div id='textareas'>
        <textarea id="dataChannelSend" disabled placeholder="Press Start, enter some text, then press Send."></textarea>
        <textarea id="dataChannelReceive" disabled></textarea>
    </div>
    -->
    <p id="status_text"><b> Input username and password to login:</b></p>
    <input name='username' type='text' id='username' maxlength="50" />
    <button id="Login" >Login</button>
    <button id="Logout" disabled>Logout</button>
    <button id='StopCall' disabled>Hang Up</button>
    <br/>    <br/>

    <div id='client_div' style="visibility:hidden">
        <p id='onlineclientstext' > Other Online Clients </p>
        <table id='client_table' border='2'>
            <tr>
                <th>Client ID</th>
                <th>User Name</th>
                <th>IP Address</th>
                <th>Calling Status</th>
                <th>Action</th>
            </tr>
        </table>
    </div>


</div>


<script type='text/javascript'>
    var client=null;
    var global_client_id=-1;
    var global_peer_id=-1;
    var isInitiator=false;
    var isStarted=false;
    var isJoined=false;
    var isConnected=false;
    var serverAddress='ws://127.0.0.1:8080/WhiteboardApp/whiteboardendpoint';

    var audio_send_codec = '';
    var audio_receive_codec = 'opus/48000';
</script>

<script type='text/javascript' src="js/webrtcClient.js"></script>

<script>
    var client_div=document.getElementById('client_div');
    var online_client_text=document.getElementById('onlineclientstext');
    var online_client_text_str=online_client_text.innerHTML;
    var client_table=document.getElementById('client_table');
    var loginButton=document.getElementById('Login');
    var logoutButton=document.getElementById("Logout");
    var stopCallButton=document.getElementById('StopCall');
    var statusText=document.getElementById("status_text");


    //add listener
    if(stopCallButton.addEventListener)
    {
        stopCallButton.addEventListener('click',onStopCall);
    }

    if(loginButton.addEventListener)
    {
        loginButton.addEventListener('click',onButtonLogin);
    }


    if(logoutButton.addEventListener)
    {
        logoutButton.addEventListener('click',onButtonLogout);
    }

    function onButtonLogin()
    {


        var username=document.getElementById('username').value;
        if(username.length==0 || username.trim().length==0)
        {
            window.alert("Please input a valid user name!");

            return;
        }

        username=username.trim();

        loginButton.disabled=true;
        statusText.innerHTML="Connecting to server, please wait......";

        if(client==null)
        {
            console.log('client is null, creating a new one!');
            client=new WEBRTCClient(username,serverAddress);
            client.callbackEntity=window;
            client.loginCallback=loginWindowCallback;
            client.disconnectCallback=disconnectWindowCallback;


        }

        console.log("client state is "+client.state);


        if(client.connectionstate==ClientState.OFFLINE)
        {
            console.log("in offline state, need to connect to server first");
            client.connect();
        }
        else if(client.connectionstate==ClientState.CONNECTED)
        {
            console.log("in connected state, need to log in");
            client.Login();
        }





    }


    function onButtonLogout()
    {
         if(client==null)
         return;

         if(client.connectionstate==ClientState.OFFLINE)
         {


         return;
         }

         if(client.connectionstate==ClientState.CONNECTED)
         {
             //don't notify the client in this case
             client.close();
             return;

         }

         if(client.connectionstate==ClientState.LOGGEDIN)
         {


             var answer=window.confirm("Do you want to log out?");
             if(answer==true)
             {

             logoutButton.disabled=true;
             client.Logout();
             }
             return;
         }

    }

    function onStopCall()
    {

    }


    function loginWindowCallback()
    {
        statusText.innerHTML="Successfully logged in";
        logoutButton.disabled=false;
    }

    function disconnectWindowCallback()
    {
        statusText.innerHTML="Please input your username:";

        loginButton.disabled=false;



    }





</script>



</body>
</html>